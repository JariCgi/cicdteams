name: CI/CD (multi-item RSS under /feed/feed.xml, no repo writes)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    env:
      OWNER: ${{ github.repository_owner }}   # esim. jaricgi
      REPO:  ${{ github.repository }}         # esim. JariCgi/cicdteams
      SHA:   ${{ github.sha }}
      ACTOR: ${{ github.actor }}
      COMMIT_MSG: ${{ github.event.head_commit.message || 'Automated deploy' }}
      KEEP_COUNT: "10"                        # montako viimeistä itemiä pidetään feedissä

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build site (index.html)
        shell: bash
        run: |
          set -euo pipefail
          REPO_NAME="${REPO#*/}"
          BASE_URL="https://${OWNER}.github.io/${REPO_NAME}/"
          mkdir -p dist
