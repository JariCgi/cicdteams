name: Dummy CI/CD (single workflow, feed under /feed/feed.xml)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    # Näitä käytetään sekä index.html:ssä että feedissä
    env:
      REPO: ${{ github.repository }}                  # owner/repo
      OWNER: ${{ github.repository_owner }}
      SHA: ${{ github.sha }}
      COMMIT_MSG: ${{ github.event.head_commit.message || 'Automated deploy' }}
      ACTOR: ${{ github.actor }}
      COMMIT_URL: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fake build (index.html)
        run: |
          set -euo pipefail
          REPO_NAME="${REPO#*/}"
          BASE_URL="https://${OWNER}.github.io/${REPO_NAME}/"
          mkdir -p dist
          cat > dist/index.html <<HTML
          <!doctype html>
          <html lang="fi">
            <head>
              <meta charset="utf-8" />
              <meta name="viewport" content="width=device-width,initial-scale=1" />
              <title>CI/CD demo – ${REPO_NAME}</title>
              <style>
                body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:2rem;line-height:1.5}
                code{background:#f4f4f4;padding:.2rem .4rem;border-radius:.25rem}
                a{color:#0366d6;text-decoration:none}
                a:hover{text-decoration:underline}
              </style>
            </head>
            <body>
              <h1>CI/CD demo</h1>
              <p><strong>Päivitetty:</strong> $(date -u)</p>
              <p><strong>Commit:</strong> <a href="${COMMIT_URL}"><code>${SHA}</code></a></p>
              <p><strong>Tekijä:</strong> ${ACTOR}</p>
              <p>Sivun perus‑URL: <a href="${BASE_URL}">${BASE_URL}</a></p>
              <p>RSS: <a href="${BASE_URL}feed/feed.xml">${BASE_URL}feed/feed.xml</a></p>
            </body>
          </html>
          HTML

      - name: Generate RSS feed (/feed/feed.xml)
        run: |
