name: Dummy CD (Deploy Pages)

on:
  workflow_run:
    workflows: [ "Dummy CI" ]   # Täsmälleen sama kuin ci.yml:n 'name'
    types: [ completed ]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Debug workflow_run
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}"
          echo "run_id=${{ github.event.workflow_run.id }}"
          echo "head_branch=${{ github.event.workflow_run.head_branch }}"

      - name: Configure Pages
        uses: actions/configure-pages@v5

      # ⬇️ Hae CI-runista GENEERINEN artifact (nimi: 'site')
      - name: Download artifact from CI run
        uses: actions/download-artifact@v4
        with:
          name: site
          run-id: ${{ github.event.workflow_run.id }}
          path: ./site

      - name: List downloaded files
        run: |
          echo "Downloaded files:" && find ./site -maxdepth 2 -type f -print

      # ⬇️ Muunna se Pages-artifactiksi
      - name: Upload to Pages (from ./site)
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./site

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
``
